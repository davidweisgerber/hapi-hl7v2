<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 at 2023-10-30 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="James Agnew" />
    <meta name="Date-Revision-yyyymmdd" content="20231030" />
    <meta http-equiv="Content-Language" content="en" />
    <title>HAPI &#x2013; Upgrading from HAPI 2.0</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
      <script type="text/javascript" src="./js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarDisabled">
      <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><a href="https://hapifhir.github.io/hapi-hl7v2" id="bannerLeft"><img src="images/hapi_banner.png"  alt="HAPI"/></a></div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2023-10-30<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 2.5</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="http://www.uhn.ca/" class="externalLink" title="University Health Network">University Health Network</a></li>
      <li class="pull-right"><span class="divider">|</span>
<a href="http://hl7.org/" class="externalLink" title="hl7.org">hl7.org</a></li>
      <li class="pull-right"><a href="https://github.com/hapifhir/hapi-hl7v2" class="externalLink" title="GitHub Project Page">GitHub Project Page</a></li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
          <li class="nav-header">Welcome</li>
    <li><a href="index.html" title="Introduction"><span class="none"></span>Introduction</a>  </li>
    <li><a href="changes-report.html" title="Changelog"><span class="none"></span>Changelog</a>  </li>
    <li><a href="https://smilecdr.com/blog/" class="externalLink" title="Blog"><span class="none"></span>Blog</a>  </li>
          <li class="nav-header">FHIR</li>
    <li><a href="hapi-fhir/" title="HAPI FHIR"><span class="none"></span>HAPI FHIR</a>  </li>
          <li class="nav-header">Tools</li>
    <li><a href="hapi-testpanel/index.html" title="TestPanel"><span class="none"></span>TestPanel</a>  </li>
    <li><a href="hapi-hl7overhttp/index.html" title="HL7 over HTTP"><span class="none"></span>HL7 over HTTP</a>  </li>
    <li><a href="colouriser.html" title="Colouriser"><span class="none"></span>Colouriser</a>  </li>
          <li class="nav-header">Download</li>
    <li><a href="https://sourceforge.net/projects/hl7api/files/hl7api/" class="externalLink" title="Download Java API"><span class="none"></span>Download Java API</a>  </li>
    <li><a href="hapi-testpanel/install.html" title="Download TestPanel"><span class="none"></span>Download TestPanel</a>  </li>
          <li class="nav-header">Documentation</li>
    <li><a href="getting_started.html" title="Getting Started"><span class="none"></span>Getting Started</a>  </li>
    <li><a href="devbyexample.html" title="HAPI By Example"><span class="none"></span>HAPI By Example</a>  </li>
    <li><a href="base/apidocs/index.html" title="JavaDoc (API core)"><span class="icon-chevron-down"></span>JavaDoc (API core)</a>
      <ul class="nav nav-list">
    <li><a href="v21/apidocs/index.html" title="v2.1 Messages"><span class="none"></span>v2.1 Messages</a>  </li>
    <li><a href="v22/apidocs/index.html" title="v2.2 Messages"><span class="none"></span>v2.2 Messages</a>  </li>
    <li><a href="v23/apidocs/index.html" title="v2.3 Messages"><span class="none"></span>v2.3 Messages</a>  </li>
    <li><a href="v231/apidocs/index.html" title="v2.3.1 Messages"><span class="none"></span>v2.3.1 Messages</a>  </li>
    <li><a href="v24/apidocs/index.html" title="v2.4 Messages"><span class="none"></span>v2.4 Messages</a>  </li>
    <li><a href="v25/apidocs/index.html" title="v2.5 Messages"><span class="none"></span>v2.5 Messages</a>  </li>
    <li><a href="v251/apidocs/index.html" title="v2.5.1 Messages"><span class="none"></span>v2.5.1 Messages</a>  </li>
    <li><a href="v26/apidocs/index.html" title="v2.6 Messages"><span class="none"></span>v2.6 Messages</a>  </li>
    <li><a href="v27/apidocs/index.html" title="v2.7 Messages"><span class="none"></span>v2.7 Messages</a>  </li>
    <li><a href="v28/apidocs/index.html" title="v2.8 Messages"><span class="none"></span>v2.8 Messages</a>  </li>
    <li><a href="v281/apidocs/index.html" title="v2.8.1 Messages"><span class="none"></span>v2.8.1 Messages</a>  </li>
      </ul>
  </li>
    <li><a href="xref/index.html" title="Source XRef"><span class="none"></span>Source XRef</a>  </li>
    <li><a href="hapi-faq.html" title="FAQ"><span class="none"></span>FAQ</a>  </li>
    <li><a href="conformance.html" title="Conformance Tools"><span class="none"></span>Conformance Tools</a>  </li>
    <li><a href="hapi-sourcegen/confgen-usage.html" title="Maven Plugins"><span class="none"></span>Maven Plugins</a>  </li>
          <li class="nav-header">Get Help</li>
    <li><a href="mail-lists.html" title="Mailing List"><span class="none"></span>Mailing List</a>  </li>
          <li class="nav-header">Contribute</li>
    <li><a href="building.html" title="Hacking HAPI"><span class="none"></span>Hacking HAPI</a>  </li>
    <li><a href="submissions.html" title="Submitting Code"><span class="none"></span>Submitting Code</a>  </li>
    <li><a href="issue-tracking.html" title="Issue Tracking"><span class="none"></span>Issue Tracking</a>  </li>
    <li><a href="source-repository.html" title="Source Code"><span class="none"></span>Source Code</a>  </li>
          <li class="nav-header">Reports</li>
    <li><a href="team-list.html" title="HAPI Developers"><span class="none"></span>HAPI Developers</a>  </li>
    <li><a href="surefire-report.html" title="Unit Test Report"><span class="none"></span>Unit Test Report</a>  </li>
    <li><a href="taglist.html" title="Source Tag List"><span class="none"></span>Source Tag List</a>  </li>
    <li><a href="cobertura/index.html" title="Cobertura"><span class="none"></span>Cobertura</a>  </li>
    <li><a href="license.html" title="License"><span class="none"></span>License</a>  </li>
          <li class="nav-header">Older Documentation</li>
    <li><a href="parsing.html" title="Parsing Messages"><span class="none"></span>Parsing Messages</a>  </li>
    <li><a href="installation.html" title="Installation"><span class="none"></span>Installation</a>  </li>
    <li><a href="links.html" title="Helpful Links"><span class="none"></span>Helpful Links</a>  </li>
  </ul>
          <hr />
          <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="http://maven.apache.org" title="Built with Maven 2" class="builtBy"><img class="builtBy"  alt="Built with Maven 2" src="images/logos/maven-feather.png"    /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >


	

		<section>
<h2><a name="Upgrading_from_HAPI_2.0_or_before"></a>Upgrading from HAPI 2.0 or before</h2>

			
<p>
				This document describes some of the changes between the HAPI 2.0 API newer
				versions of the API. Note that none of these changes are required yet. The
				&quot;old way&quot; of doing things is deprecated but
				still supported for the time being.
			</p>

		</section>

		<section>
<h2><a name="Upgrading_HL7_Servers"></a>Upgrading HL7 Servers</h2>

			
<p>
				HAPI 2.0 contains two complete modules for creating an HL7 Server capable
				of listening for connections from outside applications, receiving
				messages and processing them:
			</p>

			
<ul>
				
<li>
					<a href="./apidocs/ca/uhn/hl7v2/app/package-summary.html">ca.uhn.hl7v2.app.*</a>
				</li>
				
<li>
					<a href="./apidocs/ca/uhn/hl7v2/protocol/package-summary.html">ca.uhn.hl7v2.protocol.*</a>
				</li>
			</ul>

			
<p>
				The
				<code>.app.*</code>
				package contains the original server implementation
				and has always been the implementation suggested by the HAPI documentation.
				While it was very simplistic in its original implementation, it has
				received a good deal of improvement over the years from the HAPI community.
			</p>

			
<p>
				The
				<code>.protocol.*</code>
				package contains a more recent server implementation, which
				had a number of great ideas but was never completed and never received much
				attention from the HAPI community in general. As such,
				<code>.protocol.*</code>
				is being largely deprecated, and its best parts are being merged into the
				server implementations in
				<code>.app.*</code>
				.
			</p>

			<section>
<h3><a name="Migrating_Existing_code_which_uses_ca.uhn.hl7v2.protocol.impl.HL7Server"></a>Migrating Existing code which uses ca.uhn.hl7v2.protocol.impl.HL7Server</h3>

				
<p>
					If your code uses
					<a href="./apidocs/ca/uhn/hl7v2/protocol/impl/HL7Server.html">
						<code>ca.uhn.hl7v2.protocol.impl.HL7Server</code>
					</a>
					to provide an HL7 server, as in the following example:
				</p>

				
					
					
				
<div class="source"><pre class="prettyprint">      // Create a router
      ApplicationRouterImpl router = new ApplicationRouterImpl();
      AppRoutingDataImpl routingData = new AppRoutingDataImpl(&quot;*&quot;, &quot;*&quot;, &quot;*&quot;, &quot;*&quot;);

      // Create an application and bind it to the router
      MyReceivingApplication application = new MyReceivingApplication();
      router.bindApplication(routingData, application);

      // Create a server and start it
      ServerSocket socket = new ServerSocket(8888);
      NullSafeStorage storage = new NullSafeStorage();
      HL7Server hl7Server = new HL7Server(socket, router, storage);
      hl7Server.start(null);
</pre></div>
				
				
<p>
					The migration is as simple as converting your code to
					use
					<a href="./apidocs/ca/uhn/hl7v2/protocol/app/HL7Service.html">
						<code>ca.uhn.hl7v2.protocol.app.HL7Service</code>
					</a>
					instead, as in the following example:
				</p>

				
					
					
				
<div class="source"><pre class="prettyprint">      // Create a context and ask it for a service
      DefaultHapiContext ctx = new DefaultHapiContext();
      HL7Service server = ctx.newServer(8888, false);

      // Create an application and bind it to the server
      MyReceivingApplication application = new MyReceivingApplication();
      server.registerApplication(application);

      // Start the server
      server.start();
</pre></div>

			</section>
			
			<section>
<h3><a name="Migrating_Existing_code_which_uses_ca.uhn.hl7v2.Application"></a>Migrating Existing code which uses ca.uhn.hl7v2.Application</h3>
				
				
<p>
					HAPI applications which use
					<a href="./apidocs/ca/uhn/hl7v2/app/Application.html">
						<code>ca.uhn.hl7v2.app.Application</code>
					</a>
					(which is provided to a SimpleService or TwoPortServer either directly
					or using the newer HapiContext#getServer() methods)
					should migrate to the newer
					<a href="./apidocs/ca/uhn/hl7v2/protocol/ReceivingApplication.html">
						<code>ca.uhn.hl7v2.protocol.ReceivingApplication</code>
					</a>.
				</p>
				
				
<p>
					A typical old style Application looks like the following:
				</p>
				
				
					
					
				
<div class="source"><pre class="prettyprint">public static class MyApplication implements ca.uhn.hl7v2.app.Application {

   public Message processMessage(Message theMessage) throws HL7Exception {
      // ...Do something with theMessage...
      try {
         return theMessage.generateACK();
      } catch (IOException e) {
         throw new HL7Exception(e);
      }
   }

   public boolean canProcess(Message theMessage) {
      return true;
   }

}
</pre></div>
				
				
<p>
					Converting to a ReceivingApplication is as simple as changing
					the interface implemented by your handling application, and
					modifying the signature of the <code>processMessage</code> method to
					add a metadata <code>Map&lt;String, Object&gt;</code> to the
					parameter list, like so: 
				</p>
				
				
					
					
				
<div class="source"><pre class="prettyprint">public static class MyReceivingApplication implements ca.uhn.hl7v2.protocol.ReceivingApplication&lt;Message&gt; {

   public Message processMessage(Message theMessage, Map&lt;String, Object&gt; theMetadata) throws HL7Exception {

      // ...Do something with theMessage...

      try {
         return theMessage.generateACK();
      } catch (IOException e) {
         throw new HL7Exception(e);
      }
   }

   public boolean canProcess(Message theMessage) {
      return true;
   }

}

</pre></div>

				
<p>
					Once you've migrated to the ReceivingApplication interface, you
					might want to take advantage of the new metadata keys available
					in
					<a href="./apidocs/ca/uhn/hl7v2/protocol/MetadataKeys.html">
						<code>MetadataKeys</code>
					</a>
				</p>
				
			</section>
			
		</section>


	

        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2001&#x2013;2023
<a href="http://www.uhn.ca">University Health Network</a>.
All rights reserved.</p>
        </div>
        </div>
    </footer>
    </body>
</html>
