<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 at 2023-11-01 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20231101" />
    <meta http-equiv="Content-Language" content="en" />
    <title>HAPI &#x2013; </title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
      <script type="text/javascript" src="./js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarDisabled">
      <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><a href="https://hapifhir.github.io/hapi-hl7v2" id="bannerLeft"><img src="images/hapi_banner.png"  alt="HAPI"/></a></div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2023-11-01<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 2.5.1</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="http://www.uhn.ca/" class="externalLink" title="University Health Network">University Health Network</a></li>
      <li class="pull-right"><span class="divider">|</span>
<a href="http://hl7.org/" class="externalLink" title="hl7.org">hl7.org</a></li>
      <li class="pull-right"><a href="https://github.com/hapifhir/hapi-hl7v2" class="externalLink" title="GitHub Project Page">GitHub Project Page</a></li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
          <li class="nav-header">Welcome</li>
    <li><a href="index.html" title="Introduction"><span class="none"></span>Introduction</a>  </li>
    <li><a href="changes-report.html" title="Changelog"><span class="none"></span>Changelog</a>  </li>
    <li><a href="https://smilecdr.com/blog/" class="externalLink" title="Blog"><span class="none"></span>Blog</a>  </li>
          <li class="nav-header">FHIR</li>
    <li><a href="hapi-fhir/" title="HAPI FHIR"><span class="none"></span>HAPI FHIR</a>  </li>
          <li class="nav-header">Tools</li>
    <li><a href="hapi-testpanel/index.html" title="TestPanel"><span class="none"></span>TestPanel</a>  </li>
    <li><a href="hapi-hl7overhttp/index.html" title="HL7 over HTTP"><span class="none"></span>HL7 over HTTP</a>  </li>
    <li><a href="colouriser.html" title="Colouriser"><span class="none"></span>Colouriser</a>  </li>
          <li class="nav-header">Download</li>
    <li><a href="https://sourceforge.net/projects/hl7api/files/hl7api/" class="externalLink" title="Download Java API"><span class="none"></span>Download Java API</a>  </li>
    <li><a href="hapi-testpanel/install.html" title="Download TestPanel"><span class="none"></span>Download TestPanel</a>  </li>
          <li class="nav-header">Documentation</li>
    <li><a href="getting_started.html" title="Getting Started"><span class="none"></span>Getting Started</a>  </li>
    <li><a href="devbyexample.html" title="HAPI By Example"><span class="none"></span>HAPI By Example</a>  </li>
    <li><a href="base/apidocs/index.html" title="JavaDoc (API core)"><span class="icon-chevron-down"></span>JavaDoc (API core)</a>
      <ul class="nav nav-list">
    <li><a href="v21/apidocs/index.html" title="v2.1 Messages"><span class="none"></span>v2.1 Messages</a>  </li>
    <li><a href="v22/apidocs/index.html" title="v2.2 Messages"><span class="none"></span>v2.2 Messages</a>  </li>
    <li><a href="v23/apidocs/index.html" title="v2.3 Messages"><span class="none"></span>v2.3 Messages</a>  </li>
    <li><a href="v231/apidocs/index.html" title="v2.3.1 Messages"><span class="none"></span>v2.3.1 Messages</a>  </li>
    <li><a href="v24/apidocs/index.html" title="v2.4 Messages"><span class="none"></span>v2.4 Messages</a>  </li>
    <li><a href="v25/apidocs/index.html" title="v2.5 Messages"><span class="none"></span>v2.5 Messages</a>  </li>
    <li><a href="v251/apidocs/index.html" title="v2.5.1 Messages"><span class="none"></span>v2.5.1 Messages</a>  </li>
    <li><a href="v26/apidocs/index.html" title="v2.6 Messages"><span class="none"></span>v2.6 Messages</a>  </li>
    <li><a href="v27/apidocs/index.html" title="v2.7 Messages"><span class="none"></span>v2.7 Messages</a>  </li>
    <li><a href="v28/apidocs/index.html" title="v2.8 Messages"><span class="none"></span>v2.8 Messages</a>  </li>
    <li><a href="v281/apidocs/index.html" title="v2.8.1 Messages"><span class="none"></span>v2.8.1 Messages</a>  </li>
      </ul>
  </li>
    <li><a href="xref/index.html" title="Source XRef"><span class="none"></span>Source XRef</a>  </li>
    <li><a href="hapi-faq.html" title="FAQ"><span class="none"></span>FAQ</a>  </li>
    <li><a href="conformance.html" title="Conformance Tools"><span class="none"></span>Conformance Tools</a>  </li>
    <li><a href="hapi-sourcegen/confgen-usage.html" title="Maven Plugins"><span class="none"></span>Maven Plugins</a>  </li>
          <li class="nav-header">Get Help</li>
    <li><a href="mail-lists.html" title="Mailing List"><span class="none"></span>Mailing List</a>  </li>
          <li class="nav-header">Contribute</li>
    <li><a href="building.html" title="Hacking HAPI"><span class="none"></span>Hacking HAPI</a>  </li>
    <li><a href="submissions.html" title="Submitting Code"><span class="none"></span>Submitting Code</a>  </li>
    <li><a href="issue-tracking.html" title="Issue Tracking"><span class="none"></span>Issue Tracking</a>  </li>
    <li><a href="source-repository.html" title="Source Code"><span class="none"></span>Source Code</a>  </li>
          <li class="nav-header">Reports</li>
    <li><a href="team-list.html" title="HAPI Developers"><span class="none"></span>HAPI Developers</a>  </li>
    <li><a href="surefire-report.html" title="Unit Test Report"><span class="none"></span>Unit Test Report</a>  </li>
    <li><a href="taglist.html" title="Source Tag List"><span class="none"></span>Source Tag List</a>  </li>
    <li><a href="cobertura/index.html" title="Cobertura"><span class="none"></span>Cobertura</a>  </li>
    <li><a href="license.html" title="License"><span class="none"></span>License</a>  </li>
          <li class="nav-header">Older Documentation</li>
    <li><a href="parsing.html" title="Parsing Messages"><span class="none"></span>Parsing Messages</a>  </li>
    <li><a href="installation.html" title="Installation"><span class="none"></span>Installation</a>  </li>
    <li><a href="links.html" title="Helpful Links"><span class="none"></span>Helpful Links</a>  </li>
  </ul>
          <hr />
          <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="http://maven.apache.org" title="Built with Maven 2" class="builtBy"><img class="builtBy"  alt="Built with Maven 2" src="images/logos/maven-feather.png"    /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<section>
<h2><a name="Configuring_HAPI"></a>Configuring HAPI</h2>
<p>HAPI has a number of configurable properties which may be used to customize the way it operates.</p>
<ul>
<li><a href="#Configuring_HAPI">Configuring HAPI</a>
<ul>
<li><a href="#System_Properties">System Properties</a></li>
<li><a href="#HAPI_Context">HAPI Context</a></li>
<li><a href="#HAPI_Parser">HAPI Parser</a>
<ul>
<li><a href="#Default_behaviour_for_OBX-2">Default behaviour for OBX-2</a></li>
<li><a href="#Forced_Encoding">Forced Encoding</a></li>
<li><a href="#Message_ID_generation">Message ID generation</a></li>
<li><a href="#Unexpected_Segment_Behaviour">Unexpected Segment Behaviour</a></li></ul></li></ul></li></ul><section>
<h3><a name="System_Properties"></a>System Properties</h3>
<p>A number of settings are set using system properties. A future release, hopefully before long, will deprecate these properties and move to runtime flags which may by configured by individual instances of the HAPI parser and other components.</p>
<p>An <a class="externalLink" href="https://sourceforge.net/tracker/?func=detail&amp;aid=3515833&amp;group_id=38899&amp;atid=423838">issue</a> has been opened to track this task.</p></section><section>
<h3><a name="HAPI_Context"></a>HAPI Context</h3>
<p>HAPI can be configured by using one or more instances of <a class="externalLink" href="http://hl7api.sourceforge.net/base/apidocs/ca/uhn/hl7v2/HapiContext.html">HapiContext</a>, particularly its default implementation <a class="externalLink" href="http://hl7api.sourceforge.net/base/apidocs/ca/uhn/hl7v2/DefaultHapiContext.html">DefaultHapiContext</a>. The HAPI Context is the &quot;single point of contact&quot; for configuring HAPI parsers, validators, and server components. It furthermore provides factory methods that obtain parsers, validators etc. that are corresondingly configured:</p>
<div>
<pre>HapiContext context = new DefaultHapiContext();
context.setDefaultModelClassFactory(new MyOwnModelClassFactory());
PipeParser parser = context.getPipeParser();</pre></div>
<p>This code snippet modifies the default configuration by using a custom <a class="externalLink" href="http://hl7api.sourceforge.net/base/apidocs/ca/uhn/hl7v2/parser/ModelClassFactory.html">ModelClassFactory</a>. The obtained PipeParser is then configured to use this ModelClassFactory.</p>
<p>Other configuration items include <a class="externalLink" href="http://hl7api.sourceforge.net/base/apidocs/ca/uhn/hl7v2/validation/impl/builder/ValidationRuleBuilder.html">ValidationRuleBuilder</a>, <a class="externalLink" href="http://hl7api.sourceforge.net/base/apidocs/ca/uhn/hl7v2/validation/ValidationContext.html">ValidationContext</a> and ParserConfiguration (see below).</p></section><section>
<h3><a name="HAPI_Parser"></a>HAPI Parser</h3>
<p>The HAPI Parser may be configured using a <a class="externalLink" href="http://hl7api.sourceforge.net/base/apidocs/ca/uhn/hl7v2/parser/ParserConfiguration.html">ParserConfiguration</a> object.</p>
<p>The ParserConfiguration is a bean which sets and retrieves parser configuration properties and may be shared among multiple parser instances.</p><section>
<h4><a name="Default_behaviour_for_OBX-2"></a>Default behaviour for OBX-2</h4>
<p>In a normal OBX (Observation) segment, OBX-2 provides the datatype to be applied to OBX-5. So, for instance if an OBX repetition was conveying a timestamp (TS), it might look like:</p>
<div>
<pre>OBX||TS|||200901011259</pre></div>
<p>If the OBX-2 value is missing (which sometimes happens because of a misbehaving sending system), you may see an error such as &quot;OBX-5 is valued, but OBX-2 is not. A datatype for OBX-5 must be specified using OBX-2&quot;.</p>
<p>In this case, you may specify that HAPI should use a default type when none is found by specifying a default OBX-2 type:</p>
<div>
<pre>parser.getParserConfiguration().setDefaultObx2Type(&quot;ST&quot;);
ORU_R01 parsedMessage = (ORU_R01)parser.parse(someInvalidMessage);</pre></div>
<p>If the OBX-2 value is invalid, meaning that it has a value but that value is not a valid HL7 datatype (e.g. &quot;String&quot; instead of &quot;ST&quot;), you may specify a default type to assume if the OBX-2 value can not be understood. </p>
<div>
<pre>parser.getParserConfiguration().setInvalidObx2Type(&quot;ST&quot;);
ORU_R01 parsedMessage = (ORU_R01)parser.parse(someInvalidMessage);</pre></div>
<p>See <a href="./base/apidocs/ca/uhn/hl7v2/parser/ParserConfiguration.html#setDefaultObx2Typejava.lang.String">the JavaDoc</a> for examples.</p></section><section>
<h4><a name="Forced_Encoding"></a>Forced Encoding</h4>
<p>By default, when encoding a message HAPI will not encode any segments or fields that have no content and therefore have no semantic meaning in the message.</p>
<p>This can cause problems if you need to transmit a message to a system that expects certain empty content to be present in order to get &quot;hints&quot; about where in the message it is.</p>
<p>The addForcedEncode method may be used to add Terser paths which should be forced to be encoded:</p>
<div>
<pre>parser.getParserConfiguration().addForcedEncode(&quot;PATIENT_RESULT/ORDER_OBSERVATION/ORC-4&quot;);
// ORC-4 will still exist (but be empty) even if ORC has no content
String encoded = parser.encode(message);</pre></div>
<p>See <a href="./base/apidocs/ca/uhn/hl7v2/parser/ParserConfiguration.html#addForcedEncodejava.lang.String">the JavaDoc</a> for examples.</p></section><section>
<h4><a name="Message_ID_generation"></a>Message ID generation</h4>
<p>Under some circumstances HAPI creates a HL7 message, e.g. an Acknowledgement message, which is already populated with data. In this case, a unique message ID must be written into the MSH-10 field. HAPI provides a number of <a href="./base/apidocs/ca/uhn/hl7v2/util/idgenerator/IDGenerator.html">IDGenerator</a> implementations that can be used for this purpose. By default, a file serves as persistent storage of the ID, so that in case of restarts no duplicate IDs are assigned.</p>
<p>You can choose one of the other ID generators or even provide your own implementation.</p>
<div>
<pre>parser.getParserConfiguration().setIdGenerator(new InMemoryIDGenerator())</pre></div></section><section>
<h4><a name="Unexpected_Segment_Behaviour"></a>Unexpected Segment Behaviour</h4>
<p>If you are processing messages with nonstandard segments (e.g. Z-segments), the parser by default will add them where it finds them. You can configure the parser to always add them to the root message structure instead of inline in the current group: </p>
<div>
<pre>parser.getParserConfiguration().setUnexpectedSegmentBehaviour(UnexpectedSegmentBehaviourEnum.ADD_INLINE);</pre></div></section></section></section>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2001&#x2013;2023
<a href="http://www.uhn.ca">University Health Network</a>.
All rights reserved.</p>
        </div>
        </div>
    </footer>
    </body>
</html>
